#!/bin/bash
if [ -f Makefile ]; then
    echo
    echo "--------- Makefile detected ---------"
    echo
    echo "Recommended you perform this action using the following Makefile command:"
    echo
    echo -e "\tmake reset"
    echo
    echo "<ctrl>-c to quit, or <enter> to run anyway..."
    read
fi

set -e

if [ -z "$VIRTUAL_ENV" ]; then
    echo "Must be in a virtual env"
    exit 1
fi

if [ -f "package.json" ]; then
    npm install
fi
dev-wipeenv
pip install -r requirements/local.txt
fab get_backup
fab get_media
./manage.py migrate
dev-createsuperuser
